<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JWPlayer Token + ClearKey</title>
  <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  <style>
    body {
      margin: 0;
      background: #000;
    }
    #player {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="player"></div>

  <script>
    // Your JWPlayer license key
    jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";

    // Extract token from URL
    function extractTokenFromLink(link) {
      const tokenMatch = link.match(/__hdnea__=([^&]+)/);
      return tokenMatch ? tokenMatch[1] : "";
    }

    // Intercept requests and inject token if missing
    function interceptNetworkRequests(token) {
      const originalOpen = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url) {
        if (url.startsWith("https://tv.media.jio.com/")) {
          url = url.replace("tv.media.jio.com", "your.proxy.if.want.to.play.worldwide.otherwise.remains.same");
        }

        if ((url.includes(".mpd") || url.includes(".m3u8") || url.includes(".ts")) && token && !url.includes("hdnea=")) {
          url += (url.includes("?") ? "&" : "?") + "hdnea=" + token;
        }

        return originalOpen.apply(this, [method, url]);
      };
    }

    function playVideo() {
      // Example DASH stream with token
      const link = "https://jiotvmblive.cdn.jio.com/bpk-tv/Padhega_Bharat_BTS/output/index.mpd?__hdnea__=st=1756432438~exp=1756518838~acl=/*~hmac=8edea7cab50a50c0014b54d7a193a7e00bd2f8fdc7ae7c84a386352ce9a56fec";
      const tokenValue = extractTokenFromLink(link);

      if (tokenValue) {
        interceptNetworkRequests(tokenValue);
      }

      // Setup JWPlayer with ClearKey only
      const playerInstance = jwplayer("player").setup({
        playlist: [{
          file: link,
          type: "dash",
          drm: {
            clearkey: {
              keyId: "3d17067588d750e9998162e8d3bd7b78", // ðŸ”‘ Replace with your actual KID
              key: "87f6231b567ad15dc65f3002a45ded95"  // ðŸ”‘ Replace with your actual KEY
            }
          }
        }],
        width: "100%",
        aspectratio: "16:9",
        autostart: true,
        cast: { appid: "CC1AD845" }
      });

      playerInstance.on("beforePlay", function() {
        interceptNetworkRequests(tokenValue);
      });
    }

    window.onload = playVideo;

    // Telegram / join prompt
    window.addEventListener("load", function() {
      const result = window.confirm("Join for more links?");
      if (result) {
        window.location.href = "https://t.me/yourchannel"; // Replace with your channel link
      }
    });
  </script>
</body>
</html>
