<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JWPlayer DRM Loader</title>
  <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  <style>
    body {
      margin: 0;
      background: #000;
    }
    #player {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="player"></div>

  <script>
    jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";

    // Utility: get URL param
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // Utility: set cookie
    function setCookie(name, value) {
      document.cookie = name + "=" + value + "; path=/";
    }

    // Load and play selected channel
    async function loadChannel() {
      const channelId = getQueryParam("id");
      if (!channelId) {
        alert("No channel id provided in URL. Example: ?id=1373");
        return;
      }

      try {
        const response = await fetch("https://pkl.xojiv79335.workers.dev");
        const channels = await response.json();

        const channel = channels.find(ch => ch.channel_id === channelId);
        if (!channel) {
          alert("Channel not found!");
          return;
        }

        // Apply cookie
        if (channel.cookie) {
          const cookieParts = channel.cookie.split("=");
          if (cookieParts.length === 2) {
            setCookie(cookieParts[0].replace("__", ""), cookieParts[1]);
          }
        }

        // Setup JWPlayer with DRM keys
        jwplayer("player").setup({
          playlist: [{
            file: channel.channel_url,
            image: channel.channel_logo,
            type: "dash",
            drm: {
              clearkey: {
                keyId: channel.keyId,
                key: channel.key
              }
            }
          }],
          width: "100%",
          aspectratio: "16:9",
          autostart: true,
          cast: { appid: "CC1AD845" }
        });

      } catch (err) {
        console.error("Error loading channel:", err);
        alert("Failed to load channel data!");
      }
    }

    window.onload = loadChannel;

    // Telegram popup
    window.addEventListener("load", function () {
      setTimeout(() => {
        const result = window.confirm("ðŸ“£ Join our Telegram Channel for more free links and updates!");
        if (result) {
          window.location.href = "https://t.me/your_channel"; // Replace with your Telegram link
        }
      }, 1500);
    });
  </script>
</body>
</html>
