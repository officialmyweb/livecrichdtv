<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="no-referrer" />
  <title>Telegram-Live-Cric-Hd</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.12.6/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.12.6/controls.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://livecrichdofficial.pages.dev/livecrichd2.css" />
</head>
<body>
<div id="player-container">
  <div data-shaka-player-container class="shaka-video-container">
    <video autoplay data-shaka-player id="video" poster="https://i.ibb.co/wzxpfcC/IMG-20240601-170942.jpg"></video>
  </div>
</div>

<script defer src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>

<script>
  const allowedDomain = "livecrichdtv.pages.dev";
  if (window.top !== window.self || window.location.hostname !== allowedDomain) {
    window.top.location.href = "https://telegram.me/livecrichdofficial";
  }

  if (confirm("Join Our Telegram Channel @livecrichdofficial")) {
    window.location.href = "https://telegram.me/livecrichdofficial";
  }

  const manifestUri = "https://otte.live.fly.ww.aiv-cdn.net/pdx-nitro/live/clients/dash/enc/tftudkctiy/out/v1/21d351e17f284d56ba835597fcac3e3c/cenc.mpd";
  const drmKeys = {
    "c5baabaaf817abc314702e6fc615571f": "35f6b737c5b2c3d657a37b2bff894916"
  };

  async function initPlayer() {
    const video = document.getElementById("video");
    const ui = video["ui"];
    const controls = ui.getControls();
    const player = controls.getPlayer();

    ui.configure({
      controlPanelElements: ["play_pause", "mute", "spacer", "time_and_duration", "quality", "fullscreen", "picture_in_picture", "overflow_menu"],
      overflowMenuButtons: ["captions", "cast", "quality", "language"]
    });

    player.configure({
      drm: { clearKeys: drmKeys },
      streaming: {
        jumpLargeGaps: true,
        smallGapLimit: 0.5,
        lowLatencyMode: true,
        inaccurateManifestTolerance: 5,
        rebufferingGoal: 10,
        bufferingGoal: 20,
        liveSyncDuration: 20,
        alwaysStreamText: true,
        startAtSegmentBoundary: true
      }
    });

    player.addEventListener("error", e => console.error("Player error", e.detail));
    controls.addEventListener("error", e => console.error("UI error", e.detail));

    try {
      await player.load(manifestUri);
      console.log("Video loaded successfully!");
    } catch (err) {
      console.error("Error loading video:", err);
    }

    // Detect when stuck near the end of an over (or segment boundary)
    setInterval(() => {
      const buffered = video.buffered;
      if (buffered.length && video.currentTime >= buffered.end(0) - 0.5) {
        console.warn("Near end of buffer, ensuring smooth transition...");
        // Preload next segment or adjust buffering behavior
        player.getVideoElement().play();  // Ensure playback keeps moving
      }
    }, 3000);  // Check every 3 seconds for buffer state

    // Soft recovery after each over (or segment)
    setInterval(() => {
      const currentTime = video.currentTime;
      const duration = video.duration;
      if (currentTime >= duration - 1) {  // When it's near the end of an over
        console.log("Buffering or reloading for smooth transition...");
        video.currentTime = currentTime - 2;  // Slightly backtrack to avoid stuck
      }
    }, 5000);  // Check every 5 seconds for smooth transition
  }

  function configureLogo() {
    const logo = document.createElement("img");
    logo.src = "https://i.ibb.co/7VF2dfy/1000000077-removebg-preview.png";
    logo.alt = "Logo";
    logo.className = "logo";
    logo.addEventListener("click", () => {
      window.location.href = "https://telegram.me/livecrichdofficial";
    });

    document.querySelector(".shaka-video-container").appendChild(logo);
  }

  document.addEventListener("shaka-ui-loaded", () => {
    initPlayer();
    configureLogo();
  });

  document.addEventListener("shaka-ui-load-failed", () => {
    console.error("Unable to load the Shaka UI!");
  });
</script>
</body>
</html>
