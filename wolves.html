<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>djs Player - Built-In UI Controls</title>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #videoContainer {
      position: relative;
      width: 80%;
      max-width: 1200px;
    }
    video {
      width: 100%;
      height: auto;
    }
    .dash-ui-controls {
      position: absolute;
      bottom: 20px;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-between;
      color: white;
      font-size: 16px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
    }
    select, button {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="videoContainer">
    <video id="videoPlayer" controls autoplay></video>
    <div class="dash-ui-controls">
      <!-- Quality Control -->
      <div>
        <label for="qualitySelect">Quality:</label>
        <select id="qualitySelect">
          <option value="auto">Auto</option>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>

      <!-- Language Control -->
      <div>
        <label for="languageSelect">Language:</label>
        <select id="languageSelect">
          <option value="eng">English</option>
          <option value="spa">Spanish</option>
          <option value="fre">French</option>
          <!-- Add more languages as required -->
        </select>
      </div>

      <!-- Playback Speed Control -->
      <div>
        <label for="speedSelect">Speed:</label>
        <select id="speedSelect">
          <option value="1.0">Normal</option>
          <option value="1.25">1.25x</option>
          <option value="1.5">1.5x</option>
          <option value="2.0">2x</option>
        </select>
      </div>
    </div>
  </div>

  <script>
    const videoElement = document.getElementById("videoPlayer");
    const qualitySelect = document.getElementById("qualitySelect");
    const languageSelect = document.getElementById("languageSelect");
    const speedSelect = document.getElementById("speedSelect");

    // Create the dash.js player instance
    const player = dashjs.MediaPlayer().create();

    // Initialize the player
    player.initialize(videoElement, 
      "https://otte.live.fly.ww.aiv-cdn.net/pdx-nitro/live/clients/dash/enc/fg5nk2nauv/out/v1/37fe96ef48a74ac78bc598fa12caa8bd/cenc.mpd", 
      true
    );

    // Set ClearKey protection data
    player.setProtectionData({
      "org.w3.clearkey": {
        "clearkeys": {
          "f912fa528f10ba46e035c5fb6f988744": "8080b1f738fd62d6d692c7db101c4fbf"
        }
      }
    });

    // Set player settings (buffer, live delay, ABR)
    player.updateSettings({
      streaming: {
        buffer: {
          fastSwitchEnabled: true,
          stableBufferTime: 12,
          bufferTimeAtTopQuality: 20,
        },
        liveDelay: 10,
        abr: {
          autoSwitchBitrate: {
            video: true,
            audio: true
          },
          useDefaultABRRules: true
        }
      }
    });

    // Quality control logic
    qualitySelect.addEventListener("change", function() {
      const selectedQuality = qualitySelect.value;
      if (selectedQuality === "auto") {
        player.updateSettings({ streaming: { abr: { autoSwitchBitrate: { video: true } } } });
      } else {
        player.updateSettings({ streaming: { abr: { autoSwitchBitrate: { video: false } } } });
        let bitrate;
        if (selectedQuality === "low") bitrate = 500000; // Low bitrate
        else if (selectedQuality === "medium") bitrate = 1500000; // Medium bitrate
        else if (selectedQuality === "high") bitrate = 5000000; // High bitrate
        player.setQualityFor('video', bitrate);
      }
    });

    // Language control logic
    languageSelect.addEventListener("change", function() {
      const selectedLanguage = languageSelect.value;
      const audioTracks = player.getTracksFor('audio');
      const track = audioTracks.find(t => t.lang === selectedLanguage);
      if (track) player.setAudioTrack(track.index);
    });

    // Playback speed control logic
    speedSelect.addEventListener("change", function() {
      const speed = parseFloat(speedSelect.value);
      videoElement.playbackRate = speed;
    });

    // Error handling (optional)
    player.on("error", function(e) {
      console.error("dash.js error:", e);
    });
  </script>
</body>
</html>
