<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<title>Telegram-Live-Cric-Hd</title>

<!-- Shaka -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css" crossorigin="anonymous">

<link rel="stylesheet" href="https://livecrichdofficial.pages.dev/livecrichd2.css">
<script src="https://lchdxfootball.pages.dev/sknzx.js"></script>

<style>
.logo{
    position:absolute;
    top:12px;
    right:12px;
    width:70px;
    z-index:30;
    opacity:.85;
    cursor:pointer;
}
.skip-btn{
    position:absolute;
    bottom:150px;
    right:20px;
    z-index:50;
    padding:8px 14px;
    font-size:14px;
    background:#000;
    color:#fff;
    border:1px solid #fff;
    cursor:pointer;
}
</style>
</head>

<body>

<div id="player-container">
<div data-shaka-player-container class="shaka-video-container">
    <video autoplay playsinline data-shaka-player id="video"></video>
</div>
</div>

<script>
/* DOMAIN LOCK */
const allowedDomain="livecrichdtv.pages.dev";
if(window.top!==window.self || location.hostname!==allowedDomain){
    location.href="https://telegram.me/livecrichdofficial";
}

/* TELEGRAM PROMPT */
if(confirm("Join Our Telegram Channel @livecrichdofficial")){
    location.href="https://telegram.me/livecrichdofficial";
}

/* DECRYPT */
const decryptionKey="gf676rc7gr4grg78r6ag56gg8f76713f";
function decryptBase64(e,k){
    const d=atob(e);let o='';
    for(let i=0;i<d.length;i++){
        o+=String.fromCharCode(d.charCodeAt(i)^k.charCodeAt(i%k.length));
    }
    return JSON.parse(o);
}
function getURLParameter(n){
    return new URLSearchParams(location.search).get(n);
}

const id=getURLParameter("id");
if(!encodedChannelData[id]){
    alert("Invalid ID");
    location.href="https://telegram.me/livecrichdofficial";
}
const selectedData=decryptBase64(encodedChannelData[id],decryptionKey);

/* DEMO VAST XML (REPLACE LATER WITH COMPANY TAG) */
const DEMO_VAST_XML = `
<VAST version="3.0">
  <Ad>
    <InLine>
      <Creatives>
        <Creative>
          <Linear skipoffset="00:00:05">
            <MediaFiles>
              <MediaFile type="application/dash+xml">
                https://storage.googleapis.com/shaka-demo-assets/angel-one/dash.mpd
              </MediaFile>
            </MediaFiles>
          </Linear>
        </Creative>
      </Creatives>
    </InLine>
  </Ad>
</VAST>
`;

/* PARSE VAST */
function parseVast(xml){
    const doc=new DOMParser().parseFromString(xml,"text/xml");
    const media=doc.querySelector("MediaFile").textContent.trim();
    const skip=doc.querySelector("Linear")?.getAttribute("skipoffset")||"00:00:05";
    const skipSec=skip.split(":").reduce((a,v)=>a*60+Number(v),0);
    return {adMPD:media,skipTime:skipSec};
}

/* INIT PLAYER */
async function initPlayer(){
    const video=document.getElementById("video");
    const ui=video['ui'];
    const controls=ui.getControls();
    const player=controls.getPlayer();

    ui.configure({
        controlPanelElements:[
            'play_pause','mute','spacer',
            'time_and_duration','quality','fullscreen'
        ]
    });

    player.configure({
        drm:{clearKeys:selectedData.DRMKeys}
    });

    addLogo();
    const vast=parseVast(DEMO_VAST_XML);
    await playVastPreroll(player,vast);
}

/* LOGO */
function addLogo(){
    const img=document.createElement("img");
    img.src="https://i.ibb.co/7VF2dfy/1000000077-removebg-preview.png";
    img.className="logo";
    img.onclick=()=>location.href="https://telegram.me/livecrichdofficial";
    document.querySelector(".shaka-video-container").appendChild(img);
}

/* VAST PRE-ROLL */
async function playVastPreroll(player,vast){
    const MAIN_MPD=selectedData.ManifestURI;
    const container=document.querySelector(".shaka-video-container");
    let switched=false;

    const skip=document.createElement("button");
    skip.className="skip-btn";
    skip.textContent=`Skip Ad (${vast.skipTime})`;
    container.appendChild(skip);

    let counter=vast.skipTime;
    const timer=setInterval(()=>{
        counter--;
        skip.textContent=counter>0?`Skip Ad (${counter})`:"Skip Ad";
        if(counter<=0){
            skip.onclick=loadMain;
            clearInterval(timer);
        }
    },1000);

    function loadMain(){
        if(switched) return;
        switched=true;
        skip.remove();
        player.load(MAIN_MPD);
    }

    try{
        await player.load(vast.adMPD);
        setTimeout(loadMain,15000); // safety fallback
    }catch{
        loadMain();
    }
}

document.addEventListener("shaka-ui-loaded",initPlayer);
</script>

</body>
</html>
