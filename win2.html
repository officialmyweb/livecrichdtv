<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ISL 2026 Multi Language Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #222; color: white; padding: 20px; }
    select, button { margin: 5px; padding: 8px; font-size: 14px; }
    video { width: 100%; height: 60vh; margin-top: 15px; background: black; }
  </style>
</head>
<body>

<h2>ISL 2026 Live Streams</h2>

<select id="matchSelect">
  <option>Loading matches...</option>
</select>

<select id="langSelect">
  <option>Select language</option>
</select>

<select id="qualitySelect">
  <option>Select quality</option>
</select>

<button id="playBtn">Play Stream</button>

<video id="player" controls></video>

<script>
(async function(){
  const jsonUrl = "https://raw.githubusercontent.com/Jitendra-unatti/fancode/refs/heads/main/data/fancode.json";
  const data = await fetch(jsonUrl).then(res => res.json());

  // Filter only ISL 2026 entries
  const islMatches = data.filter(item => item.tour && item.tour.name && item.tour.name.includes("ISL")); 

  const matchSelect = document.getElementById("matchSelect");
  const langSelect = document.getElementById("langSelect");
  const qualitySelect = document.getElementById("qualitySelect");
  const player = document.getElementById("player");

  // Populate match list
  matchSelect.innerHTML = "";
  islMatches.forEach((m, idx) => {
    matchSelect.innerHTML += `<option value="${idx}">${m.name}</option>`;
  });

  matchSelect.onchange = () => {
    const idx = matchSelect.value;
    const match = islMatches[idx];
    const langs = {};

    // Group streams by language
    match.auto_streams.forEach(stream => {
      const lang = stream.language;
      if (!langs[lang]) langs[lang] = [];
      langs[lang].push(stream.auto);
    });

    // Populate languages
    langSelect.innerHTML = "<option>Select language</option>";
    for (let l in langs) {
      langSelect.innerHTML += `<option value="${l}">${l}</option>`;
    }

    langSelect.onchange = () => {
      const selectedLang = langSelect.value;
      const streams = langs[selectedLang];

      qualitySelect.innerHTML = "<option>Select quality</option>";
      streams.forEach(s => {
        // Extract resolution from m3u8 URL
        const quality = s.match(/\\/(\\d+p5?)\\.m3u8/);
        const label = quality ? quality[1] : s;
        qualitySelect.innerHTML += `<option value="${s}">${label}</option>`;
      });
    };
  };

  document.getElementById("playBtn").onclick = () => {
    const url = qualitySelect.value;
    if (!url) return alert("Select quality first");

    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(player);
    } else {
      player.src = url;
    }
  };

})();
</script>

</body>
</html>
