<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ISL Streams</title>
<style>
body{background:#111;color:white;font-family:Arial;padding:15px;}
select{padding:8px;margin:5px;}
iframe{width:100%;height:70vh;border:none;margin-top:10px;background:black;}
</style>
</head>
<body>

<h2 id="title">ISL 2025 - 2026</h2>

<select id="lang">
<option>Select Language</option>
</select>

<select id="quality">
<option>Select Quality</option>
</select>

<iframe id="frame"></iframe>

<script>

const jsonUrl = "https://raw.githubusercontent.com/Jitendra-unatti/fancode/main/data/fancode.json";

let streams = {};

fetch(jsonUrl)
.then(r=>r.json())
.then(data=>{

  // FILTER ONLY ISL FOOTBALL
  const isl = data.filter(m =>
    m.category === "Football" &&
    m.tournament &&
    m.tournament.includes("ISL 2025-26")
  );

  if(!isl.length){
    document.getElementById("title").innerText="No ISL Found";
    return;
  }

  // GROUP SAME MATCH
  const matchId = isl[0].match_id;
  const sameMatch = isl.filter(m=>m.match_id===matchId);

  document.getElementById("title").innerText = sameMatch[0].title;

  sameMatch.forEach(m=>{

    const lang = m.language;
    streams[lang] = {};

    const auto = m.auto_streams?.[0]?.auto;
    if(!auto) return;

    const urls = auto.match(/https:\/\/.*?\.m3u8\?hdntl=.*?(?=\n|$)/g);

    if(urls){
      urls.forEach(u=>{
        const q = u.match(/\/(\d+p5?|\d+p)\.m3u8/);
        if(q){
          streams[lang][q[1]] = u;
        }
      });
    }

  });

  // populate languages
  const langSelect = document.getElementById("lang");
  Object.keys(streams).forEach(l=>{
    langSelect.innerHTML += `<option value="${l}">${l}</option>`;
  });

});

// language change
document.getElementById("lang").addEventListener("change",function(){

  const qSelect = document.getElementById("quality");
  qSelect.innerHTML="<option>Select Quality</option>";

  const lang = this.value;
  if(streams[lang]){
    Object.keys(streams[lang]).forEach(q=>{
      qSelect.innerHTML += `<option value="${streams[lang][q]}">${q}</option>`;
    });
  }

});

// quality change
document.getElementById("quality").addEventListener("change",function(){

  const url = this.value;
  if(url){
    document.getElementById("frame").src =
      "player.html?url="+encodeURIComponent(url);
  }

});

</script>

</body>
</html>
