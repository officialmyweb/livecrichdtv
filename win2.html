<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ISL 2025 - 2026</title>
<style>
body{
  background:#111;
  color:white;
  font-family:Arial;
  padding:20px;
}
h1,h2{
  margin:10px 0;
}
select{
  padding:10px;
  margin:10px 5px 10px 0;
  font-size:15px;
}
button{
  padding:10px 15px;
  font-size:15px;
  cursor:pointer;
}
</style>
</head>
<body>

<h1>ISL 2025 - 2026</h1>
<h2 id="matchTitle">Loading Live Match...</h2>

<select id="languageSelect">
  <option>Select Language</option>
</select>

<select id="qualitySelect">
  <option>Select Quality</option>
</select>

<button id="goBtn">Watch Stream</button>

<script>

const jsonUrl = "https://raw.githubusercontent.com/Jitendra-unatti/fancode/main/data/fancode.json";

let streams = {};

fetch(jsonUrl)
.then(res => res.json())
.then(raw => {

  // If JSON root is object with data[]
  const data = Array.isArray(raw) ? raw : raw.data;

  // Filter ISL Football matches
  const islMatches = data.filter(m =>
    m.category === "Football" &&
    m.tournament &&
    m.tournament.includes("ISL 2025-26")
  );

  if(!islMatches.length){
    document.getElementById("matchTitle").innerText = "No ISL Match Found";
    return;
  }

  // Take first ISL match group
  const matchId = islMatches[0].match_id;
  const sameMatch = islMatches.filter(m => m.match_id === matchId);

  document.getElementById("matchTitle").innerText =
    "Live Match - " + sameMatch[0].title;

  // Extract language streams
  sameMatch.forEach(match => {

    const lang = match.language;
    streams[lang] = {};

    const autoText = match.auto_streams?.[0]?.auto;
    if(!autoText) return;

    const urls = autoText.match(/https:\/\/.*?\.m3u8\?hdntl=.*?(?=\n|$)/g);

    if(urls){
      urls.forEach(url => {
        const qMatch = url.match(/\/(\d+p5?|\d+p)\.m3u8/);
        if(qMatch){
          streams[lang][qMatch[1]] = url;
        }
      });
    }

  });

  // Populate languages
  const langSelect = document.getElementById("languageSelect");
  Object.keys(streams).forEach(lang => {
    langSelect.innerHTML += `<option value="${lang}">${lang}</option>`;
  });

})
.catch(err=>{
  document.getElementById("matchTitle").innerText = "Error Loading JSON";
  console.log(err);
});

// When language changes → show qualities
document.getElementById("languageSelect").addEventListener("change", function(){

  const qualitySelect = document.getElementById("qualitySelect");
  qualitySelect.innerHTML = "<option>Select Quality</option>";

  const lang = this.value;

  if(streams[lang]){
    Object.keys(streams[lang]).forEach(q=>{
      qualitySelect.innerHTML += `<option value="${streams[lang][q]}">${q}</option>`;
    });
  }

});

// When user clicks Watch → redirect
document.getElementById("goBtn").addEventListener("click", function(){

  const selectedUrl = document.getElementById("qualitySelect").value;

  if(!selectedUrl){
    alert("Please select language and quality");
    return;
  }

  // Redirect directly to M3U8
  window.location.href = selectedUrl;

});

</script>

</body>
</html>
