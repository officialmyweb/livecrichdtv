<!DOCTYPE html>
<html lang="en">
<head>
  <title>Live Stream Player</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <meta name="referrer" content="no-referrer"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.6.12/dist/plyr.css"/>

  <style>
    body {
      background-color: #000;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    html, body {
      height: 100%;
    }
    video {
      width: 100%;
      height: 100%;
      max-width: 100%;
      object-fit: contain;
    }
    .plyr {
      height: 100%;
    }

    /* Video Modes */
    video.fit-contain { object-fit: contain !important; }
    video.fit-cover   { object-fit: cover !important; }
    video.fit-fill    { object-fit: fill !important; }
    video.fit-none    { object-fit: none !important; }
  </style>
</head>

<body>

<video id="player" autoplay muted controls crossorigin playsinline></video>

<script src="https://lchdxfootball.pages.dev/premium.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.1.4/dist/hls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.6.12/dist/plyr.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const video = document.getElementById('player');

  // Get Stream ID
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id || !streamMap[id]) {
    document.body.innerHTML = "<h2 style='color:white;text-align:center;margin-top:20%;'>Invalid Stream ID</h2>";
    return;
  }

  const source = streamMap[id].url;
  const poster = streamMap[id].poster;

  if (poster) {
    video.setAttribute("poster", poster);
  }

  if (Hls.isSupported()) {

    const hls = new Hls({ maxMaxBufferLength: 100 });

    hls.loadSource(source);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, () => {

      const availableQualities = hls.levels.map(level => level.height);
      const defaultQuality = availableQualities[0];

      const player = new Plyr(video, {
        controls: ['play-large', 'play', 'mute', 'volume', 'settings', 'fullscreen'],
        settings: ['quality', 'speed'],
        quality: {
          default: defaultQuality,
          options: availableQualities,
          forced: true,
          onChange: (quality) => {
            hls.levels.forEach((level, levelIndex) => {
              if (level.height === quality) {
                hls.currentLevel = levelIndex;
              }
            });
          }
        }
      });

      // Add Video Mode Options inside settings
      setTimeout(() => {
        const settingsMenu = document.querySelector('.plyr__menu__container');

        const modeHTML = `
          <div class="plyr__control" data-mode="contain">Fit Screen</div>
          <div class="plyr__control" data-mode="cover">Fill Screen</div>
          <div class="plyr__control" data-mode="fill">Stretch</div>
          <div class="plyr__control" data-mode="none">Original</div>
        `;

        settingsMenu.insertAdjacentHTML("beforeend", modeHTML);

        document.querySelectorAll('[data-mode]').forEach(item => {
          item.addEventListener('click', function () {

            video.classList.remove('fit-contain','fit-cover','fit-fill','fit-none');

            if (this.dataset.mode === "contain") video.classList.add('fit-contain');
            if (this.dataset.mode === "cover")   video.classList.add('fit-cover');
            if (this.dataset.mode === "fill")    video.classList.add('fit-fill');
            if (this.dataset.mode === "none")    video.classList.add('fit-none');

          });
        });

      }, 500);

      // Fullscreen Orientation Lock
      document.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement) {
          if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape').catch(()=>{});
          }
        } else {
          if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock().catch(()=>{});
          }
        }
      });

    });

  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = source;
    new Plyr(video);
  } else {
    document.body.innerHTML = '<h2 style="color:white;text-align:center;margin-top:20%;">HLS Not Supported</h2>';
  }

});
</script>

</body>
</html>
